# PROMPT PARA IA - FRONTEND SAAI TRABAJADOR (React Native)

## üéØ CONTEXTO DEL PROYECTO

Estoy desarrollando una aplicaci√≥n m√≥vil React Native para **TRABAJADORES DE TIENDA** del sistema SAAI (Smart Assistant for Inventory). Esta es 1 de 3 aplicaciones del ecosistema.

**Rol del usuario:** TRABAJADOR/WORKER
- Permisos: Gesti√≥n de productos, registro de ventas, consulta de notificaciones
- Sin acceso a: Gastos, anal√≠tica, reportes, usuarios, predicciones ML

**Backend:** AWS Serverless (API Gateway + Lambda + DynamoDB)
- Autenticaci√≥n: JWT (Bearer token)
- Multi-tenant: Cada trabajador pertenece a UNA tienda (tenant_id en JWT)
- WebSockets: Notificaciones en tiempo real

---

## üìö ARCHIVOS DE REFERENCIA OBLIGATORIOS

**IMPORTANTE:** Antes de escribir cualquier c√≥digo, debes leer y entender completamente estos documentos:

### 1. SAAI_oficial.txt
- **Secci√≥n cr√≠tica:** "2. Arquitectura TRABAJADOR"
  - 2.1 Endpoints (Request/Response) - L√≠neas 82-510
  - 2.2 Lambdas (qu√© hace cada una) - L√≠neas 512-705
- **Convenciones del backend:** L√≠neas 1-80
  - Autenticaci√≥n y JWT
  - Multi-tenant (tenant_id)
  - Modelo DynamoDB (tenant_id + entity_id + data)
  - C√≥digos vs UUIDs (el frontend SOLO usa c√≥digos: T001P001, T001V005, etc.)
  - Fecha/Hora Per√∫ (backend decide timestamps)
  - Paginaci√≥n (limit + next_token)

### 2. SAAI_resumen_tecnico.txt
- Arquitectura general del sistema
- Flujo de autenticaci√≥n
- WebSockets y eventos en tiempo real
- Persistencia y modelo de datos

### 3. SAAI_Backend_Complete.postman_collection.json
- **Usar como referencia para:**
  - Request bodies exactos (estructura JSON)
  - Response esperados (estructura de datos)
  - Headers requeridos (Authorization: Bearer)
  - Variables de colecci√≥n (base_url, tokens, etc.)
- **M√≥dulos relevantes para TRABAJADOR:**
  - 1. AUTH ‚Üí Login Worker
  - 3. PRODUCTOS ‚Üí Crear, Listar, Buscar, Actualizar, Eliminar
  - 4. VENTAS ‚Üí Calcular Monto, Registrar, Listar, Buscar
  - 9. NOTIFICACIONES ‚Üí Listar

---

## üèóÔ∏è ESTRUCTURA DE LA APP

**Revisa la plantilla React Native que he creado** antes de empezar. La estructura debe ser:

```
saai-trabajador/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ screens/          # Pantallas principales
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth/
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ LoginScreen.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ productos/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ListaProductosScreen.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CrearProductoScreen.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ EditarProductoScreen.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BuscarProductosScreen.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ventas/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RegistrarVentaScreen.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ListaVentasScreen.js
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ BuscarVentasScreen.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ notificaciones/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ NotificacionesScreen.js
‚îÇ   ‚îú‚îÄ‚îÄ components/       # Componentes reutilizables
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ProductCard.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ VentaCard.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ NotificationBadge.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ SearchBar.js
‚îÇ   ‚îú‚îÄ‚îÄ services/         # L√≥gica de API y WebSocket
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api.js       # Axios instance con interceptors
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.js      # Login, logout, token management
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ productos.js # CRUD productos
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ventas.js    # Registrar/listar ventas
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ websocket.js # WebSocket connection
‚îÇ   ‚îú‚îÄ‚îÄ context/          # Estado global (Context API o Redux)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AuthContext.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ NotificationContext.js
‚îÇ   ‚îú‚îÄ‚îÄ navigation/       # React Navigation
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AppNavigator.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ AuthNavigator.js
‚îÇ   ‚îî‚îÄ‚îÄ utils/
‚îÇ       ‚îú‚îÄ‚îÄ constants.js  # API_URL, categor√≠as, m√©todos pago
‚îÇ       ‚îî‚îÄ‚îÄ helpers.js    # Formateo de fecha, moneda
‚îî‚îÄ‚îÄ App.js
```

---

## üöÄ ORDEN DE IMPLEMENTACI√ìN SUGERIDO

### FASE 1: Autenticaci√≥n y Navegaci√≥n (COMENZAR AQU√ç)
1. **LoginScreen** 
   - POST /login con email + password
   - Guardar token en AsyncStorage
   - Extraer tenant_id y codigo_usuario del response
   - Navegaci√≥n a HomeScreen despu√©s de login exitoso

2. **AuthContext**
   - Estado global: { user, token, tenant_id, isAuthenticated }
   - Funciones: login(), logout(), checkAuth()
   - Persistencia de sesi√≥n (AsyncStorage)

3. **API Service (api.js)**
   - Axios instance con baseURL
   - Interceptor para agregar Authorization: Bearer {token}
   - Interceptor para manejar errores 401 (logout autom√°tico)

### FASE 2: Productos (Core Functionality)
4. **ListaProductosScreen**
   - GET /productos con paginaci√≥n (limit + next_token)
   - FlatList con pull-to-refresh
   - Mostrar: c√≥digo, nombre, precio, stock, categor√≠a
   - Navegaci√≥n a Editar/Eliminar

5. **CrearProductoScreen**
   - Formulario: nombre, precio, stock, categor√≠a, descripci√≥n
   - POST /productos
   - Validaciones: precio > 0, stock >= 0, campos requeridos
   - Categor√≠as fijas: bebidas, snacks, abarrotes, limpieza, otros

6. **BuscarProductosScreen**
   - POST /productos/buscar con query
   - SearchBar con debounce
   - B√∫squeda por: nombre, c√≥digo, categor√≠a

7. **EditarProductoScreen**
   - PUT /productos/{codigo_producto}
   - Pre-fill del formulario con datos actuales
   - Solo editar: precio, stock, descripci√≥n (nombre y categor√≠a no se cambian)

### FASE 3: Ventas (Critical Feature)
8. **RegistrarVentaScreen**
   - Selector de productos (m√∫ltiple)
   - Cantidad por producto
   - POST /ventas/calcular (preview del total SIN guardar)
   - POST /ventas (registrar venta final)
   - Selector de m√©todo de pago: efectivo, tarjeta, yape
   - Mostrar total calculado antes de confirmar

9. **ListaVentasScreen**
   - GET /ventas con paginaci√≥n
   - Mostrar: c√≥digo, fecha, cliente, total, m√©todo pago
   - Filtros: fecha (hoy, esta semana, este mes)

10. **BuscarVentasScreen**
    - POST /ventas/buscar
    - B√∫squeda por: c√≥digo, fecha, m√©todo de pago, producto vendido

### FASE 4: Notificaciones y WebSocket
11. **NotificacionesScreen**
    - GET /notificacion con paginaci√≥n
    - Lista de alertas del sistema
    - Badge con contador de no le√≠das

12. **WebSocket Service**
    - Conectar a WebSocket API al login
    - Escuchar eventos: venta_registrada, producto_actualizado
    - Mostrar notificaciones push nativas
    - Actualizar badge de notificaciones

### FASE 5: Pulido y UX
13. **Mejoras generales**
    - Loading states (ActivityIndicator)
    - Error handling (Toast/Alert)
    - Validaciones de formularios
    - Confirmaciones antes de eliminar
    - Pull-to-refresh en todas las listas
    - Infinite scroll en listas paginadas

---

## üí° TIPS IMPORTANTES

### 1. Autenticaci√≥n
```javascript
// CORRECTO: El token se guarda en login y se usa en todas las requests
const login = async (email, password) => {
  const response = await api.post('/login', { email, password });
  const { token, user } = response.data.data;
  await AsyncStorage.setItem('token', token);
  await AsyncStorage.setItem('user', JSON.stringify(user));
  setAuthState({ token, user, isAuthenticated: true });
};

// CORRECTO: Axios interceptor agrega el token autom√°ticamente
api.interceptors.request.use(config => {
  const token = AsyncStorage.getItem('token');
  if (token) {
    config.headers.Authorization = `Bearer ${token}`;
  }
  return config;
});
```

### 2. C√≥digos vs UUIDs
```javascript
// ‚ùå INCORRECTO: Nunca uses UUID
const eliminar = (uuid) => api.delete(`/productos/${uuid}`);

// ‚úÖ CORRECTO: Usa siempre c√≥digos (T001P001, T001V005, etc.)
const eliminar = (codigo_producto) => api.delete(`/productos/${codigo_producto}`);
```

### 3. Paginaci√≥n
```javascript
const [productos, setProductos] = useState([]);
const [nextToken, setNextToken] = useState(null);

const fetchProductos = async () => {
  const params = { limit: 20 };
  if (nextToken) params.next_token = nextToken;
  
  const response = await api.get('/productos', { params });
  setProductos([...productos, ...response.data.data.productos]);
  setNextToken(response.data.data.next_token || null);
};
```

### 4. Fecha/Hora
```javascript
// ‚ùå INCORRECTO: No env√≠es fecha/hora desde el frontend
const venta = {
  productos: [...],
  fecha: new Date().toISOString() // ‚ùå NO HACER ESTO
};

// ‚úÖ CORRECTO: El backend genera la fecha autom√°ticamente
const venta = {
  productos: [...],
  metodo_pago: 'efectivo'
  // fecha NO se env√≠a
};
```

### 5. WebSockets
```javascript
// Conectar al login
const connectWebSocket = (token) => {
  const ws = new WebSocket(`wss://xxx.execute-api.us-east-1.amazonaws.com/dev?token=${token}`);
  
  ws.onmessage = (event) => {
    const { event_type, payload } = JSON.parse(event.data);
    
    if (event_type === 'venta_registrada') {
      // Mostrar notificaci√≥n push
      showNotification('Nueva venta registrada');
      // Refetch lista de ventas
      fetchVentas();
    }
  };
};
```

### 6. Validaciones
```javascript
// Validar antes de enviar al backend
const validarProducto = (data) => {
  const errors = {};
  
  if (!data.nombre || data.nombre.trim() === '') {
    errors.nombre = 'Nombre es requerido';
  }
  if (!data.precio || data.precio <= 0) {
    errors.precio = 'Precio debe ser mayor a 0';
  }
  if (!data.stock || data.stock < 0) {
    errors.stock = 'Stock no puede ser negativo';
  }
  
  return Object.keys(errors).length === 0 ? null : errors;
};
```

### 7. Error Handling
```javascript
// Manejar errores de API consistentemente
try {
  const response = await api.post('/productos', data);
  Alert.alert('√âxito', 'Producto creado correctamente');
  navigation.goBack();
} catch (error) {
  const mensaje = error.response?.data?.message || 'Error al crear producto';
  Alert.alert('Error', mensaje);
}
```

---

## üì± FEATURES ESPEC√çFICAS TRABAJADOR

### Productos
- ‚úÖ Crear, editar, eliminar, listar, buscar
- ‚úÖ Categor√≠as predefinidas (no custom)
- ‚úÖ Stock siempre >= 0
- ‚úÖ Precio siempre > 0

### Ventas
- ‚úÖ Calcular total ANTES de registrar (POST /ventas/calcular)
- ‚úÖ Descuento de stock autom√°tico (backend)
- ‚úÖ M√©todos de pago: efectivo, tarjeta, yape
- ‚úÖ Cliente opcional (default: "Cliente General")
- ‚úÖ No se pueden editar ni eliminar ventas (solo listar/buscar)

### Notificaciones
- ‚úÖ Solo lectura (generadas por backend)
- ‚úÖ Tipos: stock_bajo, venta_registrada, producto_actualizado
- ‚úÖ Badge con contador de no le√≠das
- ‚úÖ WebSocket para notificaciones en tiempo real

### Restricciones
- ‚ùå Sin acceso a gastos
- ‚ùå Sin acceso a anal√≠tica
- ‚ùå Sin acceso a reportes
- ‚ùå Sin acceso a gesti√≥n de usuarios
- ‚ùå Sin acceso a predicciones ML

---

## üé® UI/UX RECOMENDACIONES

1. **Colores:** Usar tema consistente (azul primary, verde success, rojo danger)
2. **Navegaci√≥n:** BottomTabNavigator con 3 tabs principales:
   - üè† Inicio (Dashboard simple)
   - üì¶ Productos (Lista + bot√≥n crear)
   - üí∞ Ventas (Registrar + historial)
   - üîî Notificaciones (Lista + badge)
3. **Icons:** React Native Vector Icons (MaterialCommunityIcons)
4. **Forms:** React Hook Form para validaciones
5. **Toast:** react-native-toast-message para feedback
6. **Pull to Refresh:** En todas las listas
7. **Loading:** ActivityIndicator mientras carga datos
8. **Empty States:** Mensajes amigables cuando no hay datos

---

## ‚ö†Ô∏è ERRORES COMUNES A EVITAR

1. **NO uses UUIDs**, solo c√≥digos (T001P001, T001V005)
2. **NO env√≠es fecha/hora** desde frontend (el backend decide)
3. **NO calcules totales** en frontend (usa POST /ventas/calcular)
4. **NO guardes tenant_id** manualmente (sale del JWT autom√°ticamente)
5. **NO permitas stock negativo** en formularios
6. **NO permitas editar/eliminar ventas** (solo productos)
7. **NO llames a ActualizarAnalitica** (es solo EventBridge)
8. **NO uses HTTP en producci√≥n** (solo HTTPS para WebSockets)

---

## üîß CONFIGURACI√ìN INICIAL

```javascript
// src/utils/constants.js
export const API_URL = 'https://xxx.execute-api.us-east-1.amazonaws.com/dev';
export const WS_URL = 'wss://xxx.execute-api.us-east-1.amazonaws.com/dev';

export const CATEGORIAS = [
  'bebidas',
  'snacks',
  'abarrotes',
  'limpieza',
  'otros'
];

export const METODOS_PAGO = [
  'efectivo',
  'tarjeta',
  'yape'
];
```

---

## ‚úÖ CHECKLIST DE IMPLEMENTACI√ìN

Usa este checklist para trackear progreso:

- [ ] LoginScreen + AuthContext
- [ ] API Service con interceptors
- [ ] Navegaci√≥n principal (BottomTabs)
- [ ] ListaProductosScreen con paginaci√≥n
- [ ] CrearProductoScreen con validaciones
- [ ] EditarProductoScreen
- [ ] BuscarProductosScreen
- [ ] RegistrarVentaScreen con c√°lculo previo
- [ ] ListaVentasScreen
- [ ] BuscarVentasScreen
- [ ] NotificacionesScreen
- [ ] WebSocket service
- [ ] Error handling global
- [ ] Loading states
- [ ] Pull-to-refresh
- [ ] Testing en dispositivo real

---

## üö¶ COMENZAR AHORA

**Primer paso:** Lee SAAI_oficial.txt secci√≥n "2. Arquitectura TRABAJADOR" completa.

**Segundo paso:** Revisa la estructura de carpetas de la plantilla React Native.

**Tercer paso:** Implementa LoginScreen + AuthContext (FASE 1.1 y 1.2).

**Pregunta antes de continuar:** ¬øEntendiste el flujo de autenticaci√≥n y c√≥mo se usa el JWT en todas las requests?

---

¬°Empecemos! Dime cuando hayas le√≠do los archivos de referencia y est√©s listo para implementar el LoginScreen.
