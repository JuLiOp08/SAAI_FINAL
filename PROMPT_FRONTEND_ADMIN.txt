# PROMPT PARA IA - FRONTEND SAAI ADMIN (React Web)

## ğŸ¯ CONTEXTO DEL PROYECTO

Estoy desarrollando una aplicaciÃ³n web React para **ADMINISTRADORES DE TIENDA** del sistema SAAI (Smart Assistant for Inventory). Esta es la app mÃ¡s completa de las 3 del ecosistema.

**Rol del usuario:** ADMINISTRADOR/ADMIN
- Permisos COMPLETOS: Productos, ventas, usuarios, gastos, analÃ­tica, reportes, predicciones ML, notificaciones
- Es el dueÃ±o de la tienda, tiene acceso total excepto gestiÃ³n de otras tiendas

**Backend:** AWS Serverless (API Gateway + Lambda + DynamoDB)
- AutenticaciÃ³n: JWT (Bearer token) - el token se envÃ­a en CADA request
- Multi-tenant: Cada admin pertenece a UNA tienda (tenant_id extraÃ­do del JWT por el backend)
- WebSockets: Notificaciones y actualizaciones en tiempo real
- S3: Descarga de reportes CSV (presigned URLs que expiran en 1h)
- ML: PredicciÃ³n de demanda con Holt-Winters (Docker Lambda)

**Frontend:** React + Vite + CSS + Chart.js
- CSS puro para estilos (CSS Modules o archivos .css tradicionales)
- React Router para navegaciÃ³n
- Axios para llamadas API
- Context API para estado global (almacenamiento con localStorage para persistencia)
  - **Nota:** Si usas React Query, usa `queryClient.invalidateQueries()`; si usas Context API puro, usa refetch/dispatch
- Chart.js o Recharts para grÃ¡ficos analÃ­ticos

---

## ğŸ“š ARCHIVOS DE REFERENCIA OBLIGATORIOS

**IMPORTANTE:** Antes de escribir cualquier cÃ³digo, debes leer y entender completamente estos documentos:

### 1. SAAI_oficial.txt
- **SecciÃ³n crÃ­tica:** "3. Arquitectura ADMINISTRADOR"
  - 3.1 Endpoints (Request/Response) - LÃ­neas 712-1310
  - 3.2 Lambdas (quÃ© hace cada una) - LÃ­neas 1312-1750
- **Convenciones del backend:** LÃ­neas 1-80
- **IMPORTANTE:** Leer secciÃ³n de AnalÃ­tica (ActualizarAnalitica es SOLO EventBridge, frontend usa VerAnalitica)

### 2. SAAI_resumen_tecnico.txt
- Arquitectura de AnalÃ­tica y SNS
- Predicciones ML (Holt-Winters, Docker Lambda)
- Reportes en S3 con presigned URLs
- WebSockets para eventos en tiempo real

### 3. SAAI_Backend_Complete.postman_collection.json
- **MÃ³dulos relevantes para ADMIN:**
  - 1. AUTH â†’ Login Admin
  - 2. USUARIOS â†’ CRUD completo
  - 3. PRODUCTOS â†’ CRUD completo
  - 4. VENTAS â†’ Registrar, listar, buscar
  - 5. GASTOS â†’ CRUD completo
  - 6. ANALYTICS â†’ Ver AnalÃ­tica (NO actualizar manualmente)
  - 7. REPORTES â†’ Generar 4 tipos, listar historial
  - 8. PREDICCIONES ML â†’ Predecir demanda
  - 9. NOTIFICACIONES â†’ Listar

---

## ğŸ—ï¸ ESTRUCTURA DE LA APP

```
saai-admin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â””â”€â”€ LoginPage.jsx
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ DashboardPage.jsx          # Vista general con KPIs
â”‚   â”‚   â”œâ”€â”€ productos/
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductosPage.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EditarProductoPage.jsx
â”‚   â”‚   â”‚   â””â”€â”€ BuscarProductosPage.jsx
â”‚   â”‚   â”œâ”€â”€ ventas/
â”‚   â”‚   â”‚   â”œâ”€â”€ RegistrarVentaPage.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ VentasPage.jsx
â”‚   â”‚   â”‚   â””â”€â”€ BuscarVentasPage.jsx
â”‚   â”‚   â”œâ”€â”€ usuarios/
â”‚   â”‚   â”‚   â”œâ”€â”€ UsuariosPage.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EditarUsuarioPage.jsx
â”‚   â”‚   â”‚   â””â”€â”€ BuscarUsuariosPage.jsx
â”‚   â”‚   â”œâ”€â”€ gastos/
â”‚   â”‚   â”‚   â”œâ”€â”€ GastosPage.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ EditarGastoPage.jsx
â”‚   â”‚   â”‚   â””â”€â”€ BuscarGastosPage.jsx
â”‚   â”‚   â”œâ”€â”€ analitica/
â”‚   â”‚   â”‚   â””â”€â”€ AnaliticaPage.jsx          # Dashboard analÃ­tico con grÃ¡ficos
â”‚   â”‚   â”œâ”€â”€ reportes/
â”‚   â”‚   â”‚   â”œâ”€â”€ GenerarReportesPage.jsx
â”‚   â”‚   â”‚   â””â”€â”€ HistorialReportesPage.jsx
â”‚   â”‚   â”œâ”€â”€ predicciones/
â”‚   â”‚   â”‚   â””â”€â”€ PrediccionDemandaPage.jsx
â”‚   â”‚   â””â”€â”€ notificaciones/
â”‚   â”‚       â””â”€â”€ NotificacionesPage.jsx
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ layout/
â”‚   â”‚   â”‚   â”œâ”€â”€ Navbar.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Sidebar.jsx                # MenÃº con 9 mÃ³dulos
â”‚   â”‚   â”‚   â””â”€â”€ Layout.jsx
â”‚   â”‚   â”œâ”€â”€ ui/
â”‚   â”‚   â”‚   â”œâ”€â”€ Button.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Input.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Modal.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Table.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Card.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Badge.jsx
â”‚   â”‚   â”‚   â”œâ”€â”€ Tabs.jsx
â”‚   â”‚   â”‚   â””â”€â”€ Spinner.jsx
â”‚   â”‚   â”œâ”€â”€ charts/                         # GrÃ¡ficos para analÃ­tica
â”‚   â”‚   â”‚   â”œâ”€â”€ LineChart.jsx               # Ventas diarias
â”‚   â”‚   â”‚   â”œâ”€â”€ BarChart.jsx                # Productos top
â”‚   â”‚   â”‚   â””â”€â”€ PieChart.jsx                # DistribuciÃ³n ventas
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â”œâ”€â”€ KPICard.jsx                 # Tarjetas mÃ©tricas
â”‚   â”‚   â”‚   â””â”€â”€ AlertCard.jsx
â”‚   â”‚   â”œâ”€â”€ productos/
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductCard.jsx
â”‚   â”‚   â”‚   â””â”€â”€ ProductForm.jsx
â”‚   â”‚   â”œâ”€â”€ ventas/
â”‚   â”‚   â”‚   â”œâ”€â”€ VentaCard.jsx
â”‚   â”‚   â”‚   â””â”€â”€ VentaForm.jsx
â”‚   â”‚   â”œâ”€â”€ usuarios/
â”‚   â”‚   â”‚   â”œâ”€â”€ UsuarioCard.jsx
â”‚   â”‚   â”‚   â””â”€â”€ UsuarioForm.jsx
â”‚   â”‚   â”œâ”€â”€ gastos/
â”‚   â”‚   â”‚   â”œâ”€â”€ GastoCard.jsx
â”‚   â”‚   â”‚   â””â”€â”€ GastoForm.jsx
â”‚   â”‚   â””â”€â”€ reportes/
â”‚   â”‚       â””â”€â”€ ReporteCard.jsx
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ api.js
â”‚   â”‚   â”œâ”€â”€ auth.service.js
â”‚   â”‚   â”œâ”€â”€ productos.service.js
â”‚   â”‚   â”œâ”€â”€ ventas.service.js
â”‚   â”‚   â”œâ”€â”€ usuarios.service.js
â”‚   â”‚   â”œâ”€â”€ gastos.service.js
â”‚   â”‚   â”œâ”€â”€ analitica.service.js
â”‚   â”‚   â”œâ”€â”€ reportes.service.js
â”‚   â”‚   â”œâ”€â”€ predicciones.service.js
â”‚   â”‚   â””â”€â”€ websocket.service.js
â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â”œâ”€â”€ AuthContext.jsx
â”‚   â”‚   â”œâ”€â”€ AnaliticaContext.jsx        # Estado analÃ­tica + WS
â”‚   â”‚   â””â”€â”€ NotificationContext.jsx
â”‚   â”œâ”€â”€ hooks/
â”‚   â”‚   â”œâ”€â”€ useAuth.js
â”‚   â”‚   â”œâ”€â”€ useWebSocket.js
â”‚   â”‚   â””â”€â”€ usePagination.js
â”‚   â”œâ”€â”€ utils/
â”‚   â”‚   â”œâ”€â”€ constants.js
â”‚   â”‚   â”œâ”€â”€ helpers.js
â”‚   â”‚   â””â”€â”€ chartHelpers.js            # Formateo datos grÃ¡ficos
â”‚   â”œâ”€â”€ routes/
â”‚   â”‚   â”œâ”€â”€ AppRoutes.jsx
â”‚   â”‚   â””â”€â”€ ProtectedRoute.jsx
â”‚   â””â”€â”€ App.jsx
â”œâ”€â”€ styles/                   # Estilos CSS
â”‚   â”œâ”€â”€ global.css            # Estilos globales
â”‚   â”œâ”€â”€ variables.css         # Variables CSS (colores, espaciados)
â”‚   â””â”€â”€ components/           # Estilos por componente
â”œâ”€â”€ package.json
â””â”€â”€ vite.config.js
```

---

## ğŸš€ ORDEN DE IMPLEMENTACIÃ“N SUGERIDO

### FASE 1: AutenticaciÃ³n y NavegaciÃ³n Base (COMENZAR AQUÃ)
1. **LoginPage + AuthContext**
   - POST /login (admin)
   - Guardar token + user info en localStorage
   - NavegaciÃ³n a DashboardPage

2. **API Service + Interceptors**
   - Axios con Authorization header
   - Error handling 401 â†’ logout + redirect a /login
     - **PREFERIR:** React Router navigate('/login') si estÃ¡ disponible
     - **FALLBACK:** window.location.href = '/login' solo si no hay router
   - Error handling genÃ©rico

3. **Sidebar + React Router**
   - MenÃº lateral con mÃ³dulos: Dashboard, Productos, Ventas, Usuarios, Gastos, AnalÃ­tica, Reportes, Predicciones, Notificaciones
   - Header con nombre de tienda y logout

### FASE 2: Productos + Ventas (Herencia de TRABAJADOR)

âš ï¸ **IMPORTANTE - HERENCIA DE CÃ“DIGO:**
- Los mÃ³dulos Productos y Ventas deben IMPLEMENTARSE EXACTAMENTE IGUAL que en PROMPT_FRONTEND_TRABAJADOR.txt
- NO duplicar lÃ³gica, copiar estructura y servicios
- Mantener validaciones, error handling y UX idÃ©nticas
- La Ãºnica diferencia: ADMIN tiene acceso a mÃ¡s mÃ³dulos (usuarios, gastos, analÃ­tica, etc.)

4. **MÃ³dulo Productos** (igual que TRABAJADOR)
   - ListaProductosPage
   - CrearProductoPage
   - EditarProductoPage
   - BuscarProductosPage

5. **MÃ³dulo Ventas** (igual que TRABAJADOR)
   - RegistrarVentaPage
   - ListaVentasPage
   - BuscarVentasPage

### FASE 3: Usuarios (Exclusivo ADMIN)
6. **ListaUsuariosPage**
   - GET /usuarios con paginaciÃ³n
   - Mostrar: cÃ³digo, nombre, email, rol (admin/worker), estado

7. **CrearUsuarioPage**
   - POST /usuarios
   - Formulario: nombre, email, password, rol
   - ValidaciÃ³n de email Ãºnico

8. **EditarUsuarioPage**
   - PUT /usuarios/{codigo_usuario}
   - Cambiar nombre, email, rol, estado
   - NO cambiar password (feature separada)

9. **BuscarUsuariosPage**
   - POST /usuarios/buscar
   - BÃºsqueda por: nombre, email, cÃ³digo

### FASE 4: Gastos (Exclusivo ADMIN)
10. **ListaGastosPage**
    - GET /gastos con paginaciÃ³n
    - Mostrar: cÃ³digo, descripciÃ³n, monto, categorÃ­a, fecha
    - Filtros por categorÃ­a y rango de fechas

11. **CrearGastoPage**
    - POST /gastos
    - Formulario: descripciÃ³n, monto, categorÃ­a, fecha
    - CategorÃ­as: FIJOS, VARIABLES, COMPRAS

12. **EditarGastoPage**
    - PUT /gastos/{codigo_gasto}
    - Editar monto, descripciÃ³n, categorÃ­a

13. **BuscarGastosPage**
    - POST /gastos/buscar
    - BÃºsqueda por: descripciÃ³n, categorÃ­a, fecha, monto

### FASE 5: Dashboard y AnalÃ­tica (CRÃTICO - LEER CON ATENCIÃ“N)

âš ï¸ **SEPARACIÃ“N CONCEPTUAL (UX):**
- **DashboardPage:** KPIs rÃ¡pidos (snapshot), accesos rÃ¡pidos, alertas top 3, grÃ¡fico simple
- **AnaliticaPage:** GrÃ¡ficos complejos, series temporales, comparativas, 3 periodos
- Ambos consumen GET /analitica pero con diferente presentaciÃ³n
- Dashboard = visiÃ³n ejecutiva rÃ¡pida
- AnalÃ­tica = anÃ¡lisis profundo con mÃºltiples grÃ¡ficos

14. **DashboardPage**
    - GET /analitica?periodo=semana (consultar datos pre-calculados)
    - Tarjetas KPI: Total ventas hoy, ingresos del mes, productos sin stock, gastos del mes
    - GrÃ¡fico de ventas (Ãºltimos 7 dÃ­as)
    - Alertas recientes (top 3) con severidad
    - Botones rÃ¡pidos: Registrar venta, Ver analÃ­tica completa, Generar reporte

15. **AnaliticaPage** (âš ï¸ IMPORTANTE: NO LLAMAR ActualizarAnalitica)
    - GET /analitica?periodo=semana (SOLO CONSULTAR)
    - Tabs: DÃ­a, Semana (default), Mes
    - **âŒ NUNCA HACER ESTO:** POST /analitica (endpoint NO EXISTE pÃºblicamente)
    - **âœ… CORRECTO:** ActualizarAnalitica se ejecuta SOLO por EventBridge cada 4 horas
    - **âœ… CORRECTO:** WebSocket notifica 'analitica_actualizada' â†’ refetch GET /analitica
    - **âœ… CORRECTO:** El tenant_id NO se envÃ­a, el backend lo extrae del JWT
    
    MÃ©tricas a mostrar:
    - Ventas totales (con grÃ¡fico de lÃ­nea)
    - Ganancias brutas/netas
    - Promedio de venta
    - Productos mÃ¡s vendidos (top 5, grÃ¡fico de barras)
    - Ventas diarias (grÃ¡fico de lÃ­nea)
    - Alertas automÃ¡ticas:
      * Ventas cero en periodo (CRITICAL)
      * Ganancia baja < 10% de ingresos (WARNING)
      * Productos sin stock (CRITICAL)
      * Stock bajo â‰¤ 5 unidades (WARNING)

16. **GrÃ¡ficos (Chart.js o Recharts)**
    - LineChart para ventas diarias
    - BarChart para productos top
    - PieChart para distribuciÃ³n de ventas por categorÃ­a

### FASE 6: Reportes (Exclusivo ADMIN)
17. **GenerarReportesPage**
    - 4 botones: Inventario, Ventas, Gastos, General
    - Formulario para reportes de periodo (fecha_inicio, fecha_fin)
    - POST /reportes/{tipo}
    - Mostrar download_url generado
    - BotÃ³n para abrir URL (window.open o descarga automÃ¡tica con elemento <a>)

18. **HistorialReportesPage**
    - GET /reportes/historial
    - Lista de reportes generados
    - Mostrar: cÃ³digo, tipo, fecha, tamaÃ±o
    - BotÃ³n descargar en cada item
    - **IMPORTANTE:** Los URLs son presigned (expiran en 1h), se regeneran en cada consulta

### FASE 7: Predicciones ML (Exclusivo ADMIN)
19. **PrediccionDemandaPage**
    - Selector de producto (dropdown o autocomplete)
    - POST /predicciones con codigo_producto
    - Mostrar:
      - Demanda maÃ±ana (unidades)
      - Demanda prÃ³xima semana (7 dÃ­as)
      - Stock actual vs demanda â†’ alerta si stock < demanda
    - GrÃ¡fico de predicciÃ³n (7 dÃ­as)
    - BotÃ³n "Reabastecer" que navega a EditarProductoPage con stock sugerido

### FASE 8: Notificaciones y WebSocket (CRÃTICO)
20. **NotificacionesPage** (similar a TRABAJADOR pero con mÃ¡s tipos)
    - GET /notificacion
    - Tipos de alertas:
      - stock_bajo, sin_stock
      - venta_registrada
      - ganancia_baja
      - ventas_cero
      - stockBajoManana, stockBajoProximaSemana (predicciones)
    - Badge con contador de no leÃ­das
    - Severidad: INFO, WARNING, CRITICAL

21. **WebSocket Service Completo**
    
    **FORMATO OFICIAL (VERIFICADO EN SAAI_oficial.txt):**
    - AutenticaciÃ³n: `?token=${token}` en query string
    - El token de localStorage ya estÃ¡ limpio (SIN "Bearer ")
    - Estructura de eventos: `{ event_type: string, payload: object }`
    
    **EVENTOS DISPONIBLES (ROL ADMIN):**
    1. `venta_registrada` â†’ emitido por RegistrarVenta
       - Refetch: ventas, productos, analitica (si necesario), notificaciones
    2. `producto_actualizado` â†’ emitido por ActualizarProducto
       - Refetch: productos
    3. `analitica_actualizada` â†’ emitido por ActualizarAnalitica (cada 4h)
       - **CRÃTICO**: Refetch GET /analitica (NO existe POST /analitica)
       - Refetch: notificaciones (nuevas alertas detectadas)
    4. `prediccion_generada` â†’ emitido por PrediccionDemanda
       - Refetch: notificaciones (alertas de stock vs demanda)
    
    **IMPLEMENTACIÃ“N:**
    ```javascript
    // websocket.service.js (mismo cÃ³digo que TRABAJADOR)
    // Ver PROMPT_FRONTEND_TRABAJADOR lÃ­neas 326-450 para cÃ³digo completo
    
    // Callbacks especÃ­ficos ADMIN:
    const ws = connectWebSocket(token, {
      onVentaRegistrada: (payload) => {
        queryClient.invalidateQueries(['ventas']);
        queryClient.invalidateQueries(['productos']);
        queryClient.invalidateQueries(['analitica']); // MÃ©tricas actualizadas
        queryClient.invalidateQueries(['notificaciones']);
      },
      onProductoActualizado: (payload) => {
        queryClient.invalidateQueries(['productos']);
      },
      onAnaliticaActualizada: (payload) => {
        // EventBridge acaba de ejecutar ActualizarAnalitica
        queryClient.invalidateQueries(['analitica']);
        queryClient.invalidateQueries(['notificaciones']);
      },
      onPrediccionGenerada: (payload) => {
        // Nueva predicciÃ³n disponible
        queryClient.invalidateQueries(['predicciones']);
        queryClient.invalidateQueries(['notificaciones']);
      }
    });
    ```
    
    **âš ï¸ REGLAS CRÃTICAS:**
    - NO reconectar si el cierre fue por 401/token invÃ¡lido
    - Hacer logout y redirigir a /login para evitar loops infinitos
    - MÃ¡ximo 5 intentos de reconexiÃ³n (delay 5s entre intentos)
    - Cerrar conexiÃ³n al logout con `disconnectWebSocket()`

---

## ğŸ’¡ TIPS ESPECÃFICOS ADMIN

### 1. AnalÃ­tica - NO Actualizar Manualmente (âš ï¸ MUY IMPORTANTE)
```javascript
// âŒ âŒ âŒ INCORRECTO - NUNCA HAGAS ESTO âŒ âŒ âŒ
const actualizarAnalitica = () => {
  // Este endpoint NO EXISTE pÃºblicamente
  return api.post('/analitica'); // âŒ ERROR 403
};

// âœ… âœ… âœ… CORRECTO - SOLO CONSULTAR âœ… âœ… âœ…
const fetchAnalitica = (periodo = 'semana') => {
  // El backend actualiza analÃ­tica cada 4 horas con EventBridge
  // El tenant_id NO se envÃ­a, el backend lo extrae del JWT
  return api.get('/analitica', { params: { periodo } });
};

// âœ… CORRECTO: Refetch cuando WebSocket notifica
const setupWebSocket = () => {
  ws.onmessage = (event) => {
    const { event_type } = JSON.parse(event.data);
    
    if (event_type === 'analitica_actualizada') {
      // EventBridge acaba de actualizar la analÃ­tica
      fetchAnalitica().then(data => {
        setAnaliticaData(data);
      });
    }
  };
};

// âœ… RESUMEN:
// 1. EventBridge ejecuta ActualizarAnalitica cada 4 horas (automÃ¡tico)
// 2. ActualizarAnalitica calcula mÃ©tricas y guarda en t_analitica
// 3. ActualizarAnalitica emite evento WebSocket 'analitica_actualizada'
// 4. Frontend escucha evento y hace GET /analitica (refetch)
// 5. VerAnalitica (GET) consulta t_analitica (NO recalcula)
```

### 2. REGLA CRÃTICA: NO INVENTAR ENDPOINTS
```javascript
// âš ï¸ Si necesitas un endpoint que no estÃ¡ en SAAI_oficial.txt o Postman:
// 1. Verificar que realmente no existe
// 2. Preguntar al usuario o marcarlo como TODO
// 3. NO crear rutas nuevas sin confirmaciÃ³n

// Ejemplo: âŒ NO HACER
await api.post('/productos/validar'); // Este endpoint NO existe
await api.get('/dashboard/stats');    // Este endpoint NO existe

// âœ… CORRECTO: Solo usar endpoints documentados
await api.get('/productos');           // âœ… Documentado
await api.get('/analitica');           // âœ… Documentado
```
```

### 3. Reportes - CSV con Presigned URLs (Expiran en 1h)
```javascript
// âœ… CORRECTO: Generar reporte y abrir/descargar CSV
const generarReporte = async (tipo, fechas) => {
  // tipo: 'inventario', 'ventas', 'gastos', 'general'
  // Los reportes son CSV (NO Excel), para mejor compatibilidad
  const response = await api.post(`/reportes/${tipo}`, fechas);
  const { download_url, codigo_reporte } = response.data.data;
  
  // OpciÃ³n 1: Abrir en nueva pestaÃ±a (descarga automÃ¡tica)
  window.open(download_url, '_blank');
  
  // OpciÃ³n 2: Descargar con fetch
  const link = document.createElement('a');
  link.href = download_url;
  link.download = `${tipo}_${codigo_reporte}.csv`;
  link.click();
};

// âš ï¸ IMPORTANTE: Los presigned URLs expiran en 1 hora
// En HistorialReportesPage, el backend genera URLs FRESCOS en cada GET
const fetchHistorialReportes = async () => {
  // Los download_url son regenerados en cada consulta
  const response = await api.get('/reportes/historial');
  const reportes = response.data.data.reportes;
  
  // Cada reporte tiene un download_url FRESCO (expira en 1h)
  return reportes;
};

// âŒ NO HAGAS ESTO: NO guardes URLs en localStorage
// localStorage.setItem('download_url', url); // âŒ Se vence despuÃ©s de 1h

// âœ… SIEMPRE refetch el historial para obtener URLs frescos
```

### 3. Predicciones ML - Cache y TTL
```javascript
// âœ… Las predicciones tienen cache de 24h en backend
// No es necesario guardarlas en frontend, siempre hacer POST /predicciones

const predecirDemanda = async (codigo_producto) => {
  const response = await api.post('/predicciones', { codigo_producto });
  const { demanda_manana, demanda_proxima_semana } = response.data.data;
  
  // Comparar con stock actual
  const producto = await api.get(`/productos/${codigo_producto}`);
  const stockActual = producto.data.data.stock;
  
  if (stockActual < demanda_manana) {
    toast.warning('âš ï¸ Stock Bajo: El stock no es suficiente para maÃ±ana');
  }
};
```

### 4. Usuarios - Roles
```javascript
// Roles permitidos: 'admin' y 'worker'
const crearUsuario = async (data) => {
  const usuario = {
    nombre: data.nombre,
    email: data.email,
    password: data.password,
    rol: data.rol // 'admin' o 'worker'
  };
  
  await api.post('/usuarios', usuario);
};
```

### 5. Gastos - CategorÃ­as
```javascript
// CategorÃ­as fijas en backend
const CATEGORIAS_GASTOS = [
  'FIJOS',      // Alquiler, servicios, etc.
  'VARIABLES',  // Mantenimiento, publicidad, etc.
  'COMPRAS'     // MercaderÃ­a, insumos, etc.
];

// Usar en formulario CrearGastoScreen
<Picker selectedValue={categoria} onValueChange={setCategoria}>
  {CATEGORIAS_GASTOS.map(cat => (
    <Picker.Item key={cat} label={cat} value={cat} />
  ))}
</Picker>
```

### 6. Dashboard - KPIs en Tiempo Real
```javascript
// Calcular KPIs localmente desde analÃ­tica
const calcularKPIs = (analitica) => {
  return {
    ventasHoy: analitica.periodo.dia.ventas_totales,
    ingresosHoy: analitica.periodo.dia.ingresos,
    gananciaMes: analitica.periodo.mes.ganancia_neta,
    productosSinStock: analitica.alertas.filter(a => a.tipo === 'sin_stock').length
  };
};

// Actualizar dashboard cuando llega evento WebSocket
useEffect(() => {
  if (eventType === 'analitica_actualizada') {
    fetchAnalitica().then(data => {
      setKPIs(calcularKPIs(data));
    });
  }
}, [eventType]);
```

### 7. GrÃ¡ficos - Formatear Datos
```javascript
// Formatear ventas diarias para LineChart
const formatearVentasDiarias = (ventasDiarias) => {
  return {
    labels: ventasDiarias.map(v => v.fecha.slice(5, 10)), // MM-DD
    datasets: [{
      data: ventasDiarias.map(v => v.total)
    }]
  };
};

// Usar en Chart.js o Recharts
<LineChart
  data={formatearVentasDiarias(analitica.ventas_diarias)}
  width={window.innerWidth - 40}
  height={220}
  chartConfig={{...}}
/>
```

---

## ğŸ“Š FEATURES EXCLUSIVAS ADMIN

### Dashboard Ejecutivo
- KPIs en tarjetas: ventas hoy, ingresos mes, productos sin stock, gastos mes
- GrÃ¡fico de ventas (Ãºltimos 7 dÃ­as)
- Alertas recientes (top 3)
- Accesos rÃ¡pidos

### AnalÃ­tica Completa
- 3 periodos: dÃ­a, semana, mes
- MÃ©tricas: ventas, ingresos, gastos, ganancias, promedio venta
- Productos top vendidos
- GrÃ¡fico de ventas diarias
- Alertas automÃ¡ticas (generadas cada 4h por EventBridge)

### Reportes CSV
- 4 tipos: Inventario, Ventas, Gastos, General
- Formato CSV (compatibles con Excel)
- Descarga directa desde S3
- Historial de reportes generados

### Predicciones ML
- Demanda predicha (maÃ±ana + 7 dÃ­as)
- Alertas de stock bajo segÃºn predicciÃ³n
- Sugerencias de reabastecimiento

### GestiÃ³n de Usuarios
- CRUD completo
- Roles: admin y worker
- Soft delete (estado INACTIVO)

### GestiÃ³n de Gastos
- CRUD completo
- CategorÃ­as: FIJOS, VARIABLES, COMPRAS
- BÃºsqueda y filtros avanzados

---

## âš ï¸ ERRORES COMUNES A EVITAR

1. **NO llames a ActualizarAnalitica** (endpoint no existe pÃºblicamente, solo EventBridge)
2. **NO guardes reportes en local** (los URLs expiran, siempre refetch historial)
3. **NO caches predicciones en frontend** (backend tiene cache de 24h, siempre POST)
4. **NO permitas crear usuarios con rol 'saai'** (solo admin y worker)
5. **NO permitas gastos con monto negativo**
6. **NO muestres UUIDs** al usuario (solo cÃ³digos)
7. **NO ignores eventos WebSocket** (actualiza UI en tiempo real)
8. **NO uses categorÃ­as hardcodeadas** diferentes a las del backend
9. **NO elimines fÃ­sicamente usuarios/gastos** (usar soft delete - estado INACTIVO)
   - Usuarios: cambiar estado a INACTIVO (NO DELETE)
   - Gastos: cambiar estado a INACTIVO (NO DELETE)
   - Guardar motivo_baja, fecha_baja, baja_por para auditorÃ­a

---

## ğŸ¨ UI/UX RECOMENDACIONES CON CSS

1. **Layout Principal:**
   - Navbar superior: logo, nombre tienda, notificaciones (badge), perfil
   - Sidebar izquierdo (desktop) con 9 mÃ³dulos:
     * ğŸ  Dashboard
     * ğŸ“¦ Productos
     * ğŸ’° Ventas
     * ğŸ‘¥ Usuarios
     * ğŸ’¸ Gastos
     * ğŸ“Š AnalÃ­tica
     * ğŸ“ Reportes
     * ğŸ”® Predicciones
     * ğŸ”” Notificaciones
   - MenÃº hamburguesa (mobile)
   - Contenido: `<main className="app-main">` 
     - CSS: `.app-main { padding: 24px; margin-left: 256px; margin-top: 64px; }`

2. **Dashboard - KPI Cards (CSS):**
   ```jsx
   <div className="kpi-grid">
     <div className="kpi-card">
       <div className="kpi-content">
         <div className="kpi-info">
           <p className="kpi-label">Ventas Hoy</p>
           <p className="kpi-value">S/ 1,234.50</p>
         </div>
         <div className="kpi-icon kpi-icon-blue">
           <svg className="icon">...</svg>
         </div>
       </div>
       <p className="kpi-trend kpi-trend-up">â†‘ 12% vs ayer</p>
     </div>
   </div>
   
   /* styles/components/KPICard.css */
   .kpi-grid {
     display: grid;
     grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
     gap: 1.5rem;
     margin-bottom: 1.5rem;
   }
   
   .kpi-card {
     background: white;
     border-radius: 8px;
     box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.06);
     padding: 1.5rem;
   }
   
   .kpi-content {
     display: flex;
     align-items: center;
     justify-content: space-between;
   }
   
   .kpi-label {
     font-size: 0.875rem;
     color: #6B7280;
   }
   
   .kpi-value {
     font-size: 1.875rem;
     font-weight: bold;
     color: #111827;
   }
   
   .kpi-icon {
     width: 48px;
     height: 48px;
     border-radius: 50%;
     display: flex;
     align-items: center;
     justify-content: center;
   }
   
   .kpi-icon-blue {
     background: #DBEAFE;
   }
   
   .kpi-icon .icon {
     width: 32px;
     height: 32px;
     color: #2563EB;
   }
   
   .kpi-trend {
     font-size: 0.875rem;
     margin-top: 0.5rem;
   }
   
   .kpi-trend-up {
     color: #059669;
   }
   ```

3. **GrÃ¡ficos - Chart.js con CSS:**
   ```bash
   npm install chart.js react-chartjs-2
   ```
   ```jsx
   // LineChart.jsx
   import { Line } from 'react-chartjs-2';
   
   <div className="chart-container">
     <h3 className="chart-title">Ventas Diarias</h3>
     <Line 
       data={chartData} 
       options={{
         responsive: true,
         plugins: {
           legend: { display: false }
         }
       }}
     />
   </div>
   
   /* styles/components/Charts.css */
   .chart-container {
     background: white;
     border-radius: 8px;
     box-shadow: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.06);
     padding: 1.5rem;
   }
   
   .chart-title {
     font-size: 1.125rem;
     font-weight: 600;
     margin-bottom: 1rem;
     color: #111827;
   }
   ```

4. **Tablas Responsive:**
   ```jsx
   <div className="table-wrapper">
     <table className="data-table">
       <thead>
         <tr>
           <th>CÃ³digo</th>
           <th>Nombre</th>
         </tr>
       </thead>
       <tbody>
         <tr>
           <td>T001P001</td>
           <td>Coca Cola</td>
         </tr>
       </tbody>
     </table>
   </div>
   
   /* styles/components/Table.css */
   .table-wrapper {
     overflow-x: auto;
     background: white;
     border-radius: 8px;
     box-shadow: 0 1px 3px rgba(0,0,0,0.12);
   }
   
   .data-table {
     min-width: 100%;
     border-collapse: separate;
     border-spacing: 0;
   }
   
   .data-table thead {
     background: #F9FAFB;
   }
   
   .data-table thead tr {
     border-bottom: 1px solid #E5E7EB;
   }
   
   .data-table th {
     padding: 0.75rem 1.5rem;
     text-align: left;
     font-size: 0.75rem;
     font-weight: 500;
     color: #6B7280;
     text-transform: uppercase;
   }
   
   .data-table tbody {
     background: white;
   }
   
   .data-table tbody tr {
     border-bottom: 1px solid #E5E7EB;
     transition: background-color 0.15s;
   }
   
   .data-table tbody tr:hover {
     background: #F9FAFB;
   }
   
   .data-table tbody tr:last-child {
     border-bottom: none;
   }
   
   .data-table td {
     padding: 1rem 1.5rem;
     font-size: 0.875rem;
     white-space: nowrap;
   }
   ```

5. **Alertas - Badges por Severidad:**
   ```jsx
   const SeverityBadge = ({ severity }) => {
     return (
       <span className={`badge badge-${severity.toLowerCase()}`}>
         {severity}
       </span>
     );
   };
   
   /* styles/components/Badge.css */
   .badge {
     display: inline-block;
     padding: 0.25rem 0.5rem;
     font-size: 0.75rem;
     font-weight: 600;
     border-radius: 9999px;
   }
   
   .badge-critical {
     background: #FEE2E2;
     color: #991B1B;
   }
   
   .badge-warning {
     background: #FEF3C7;
     color: #92400E;
   }
   
   .badge-info {
     background: #DBEAFE;
     color: #1E40AF;
   }
   ```

6. **Modal con CSS (Overlay + Card):**
   ```jsx
   {showModal && (
     <div className="modal-overlay">
       <div className="modal-card">
         <h2 className="modal-title">Crear Producto</h2>
         {/* Formulario */}
         <div className="modal-actions">
           <button className="btn btn-secondary">Cancelar</button>
           <button className="btn btn-primary">Guardar</button>
         </div>
       </div>
     </div>
   )}
   
   /* styles/components/Modal.css */
   .modal-overlay {
     position: fixed;
     inset: 0;
     background: rgba(0, 0, 0, 0.5);
     display: flex;
     align-items: center;
     justify-content: center;
     z-index: 50;
   }
   
   .modal-card {
     background: white;
     border-radius: 8px;
     padding: 1.5rem;
     max-width: 28rem;
     width: 100%;
   }
   
   .modal-title {
     font-size: 1.25rem;
     font-weight: bold;
     margin-bottom: 1rem;
   }
   
   .modal-actions {
     display: flex;
     justify-content: flex-end;
     gap: 0.5rem;
   }
   
   .btn {
     padding: 0.5rem 1rem;
     border: none;
     border-radius: 8px;
     cursor: pointer;
     font-weight: 500;
   }
   
   .btn-secondary {
     background: #E5E7EB;
     color: #374151;
   }
   
   .btn-primary {
     background: #2563EB;
     color: white;
   }
   ```

7. **Tabs:**
   ```jsx
   <div className="tabs-container">
     <nav className="tabs-nav">
       <button className="tab tab-active">Semana</button>
       <button className="tab">Mes</button>
     </nav>
   </div>
   
   /* styles/components/Tabs.css */
   .tabs-container {
     border-bottom: 1px solid #E5E7EB;
   }
   
   .tabs-nav {
     display: flex;
     gap: 2rem;
   }
   
   .tab {
     padding: 1rem 0.25rem;
     background: none;
     border: none;
     border-bottom: 2px solid transparent;
     color: #6B7280;
     cursor: pointer;
     transition: all 0.2s;
   }
   
   .tab:hover {
     color: #374151;
   }
   
   .tab-active {
     border-bottom-color: #2563EB;
     color: #2563EB;
     font-weight: 500;
   }
   ```

8. **Colores por Estado (Variables CSS):**
   ```css
   /* styles/variables.css */
   :root {
     /* Estados */
     --color-activo-bg: #D1FAE5;
     --color-activo-text: #065F46;
     --color-inactivo-bg: #FEE2E2;
     --color-inactivo-text: #991B1B;
     
     /* Alertas */
     --color-alert-critical-bg: #DC2626;
     --color-alert-critical-text: white;
     --color-alert-warning-bg: #F59E0B;
     --color-alert-warning-text: white;
     --color-alert-info-bg: #3B82F6;
     --color-alert-info-text: white;
   }
   
   .estado-activo {
     background: var(--color-activo-bg);
     color: var(--color-activo-text);
   }
   
   .estado-inactivo {
     background: var(--color-inactivo-bg);
     color: var(--color-inactivo-text);
   }
   
   .alerta-critical {
     background: var(--color-alert-critical-bg);
     color: var(--color-alert-critical-text);
   }
   
   .alerta-warning {
     background: var(--color-alert-warning-bg);
     color: var(--color-alert-warning-text);
   }
   
   .alerta-info {
     background: var(--color-alert-info-bg);
     color: var(--color-alert-info-text);
   }
   ```

---

## âœ… CHECKLIST DE IMPLEMENTACIÃ“N

- [ ] LoginPage + AuthContext
- [ ] Sidebar + React Router
- [ ] DashboardPage con KPIs
- [ ] MÃ³dulo Productos completo
- [ ] MÃ³dulo Ventas completo
- [ ] MÃ³dulo Usuarios completo
- [ ] MÃ³dulo Gastos completo
- [ ] AnaliticaPage con grÃ¡ficos
- [ ] WebSocket listener para 'analitica_actualizada'
- [ ] GenerarReportesPage (4 tipos)
- [ ] HistorialReportesPage
- [ ] PrediccionDemandaPage
- [ ] NotificacionesPage
- [ ] WebSocket service completo
- [ ] Error handling global (react-hot-toast)
- [ ] Loading states (spinners CSS)
- [ ] Infinite scroll o botÃ³n Cargar mÃ¡s en listas
- [ ] Testing en navegador (Chrome DevTools, responsive mode)

---

## ğŸš¦ COMENZAR AHORA

**Primer paso:** Lee SAAI_oficial.txt secciÃ³n "3. Arquitectura ADMINISTRADOR" completa (especialmente AnalÃ­tica).

**Segundo paso:** Revisa Postman collection mÃ³dulos: AUTH, USUARIOS, GASTOS, ANALYTICS, REPORTES, PREDICCIONES.

**Tercer paso:** Implementa LoginPage + AuthContext + Sidebar (FASE 1).

**Cuarto paso:** Implementa DashboardPage con KPIs bÃ¡sicos (FASE 5.14).

**Pregunta clave:** Â¿Entendiste que ActualizarAnalitica NO se llama desde frontend y que WebSocket notifica cuando hay datos nuevos?

---

Â¡Empecemos con el mÃ³dulo mÃ¡s complejo! Dime cuando hayas leÃ­do los archivos de referencia y estÃ©s listo para implementar el DashboardPage con analÃ­tica.
