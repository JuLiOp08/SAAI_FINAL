# PROMPT PARA IA - FRONTEND SAAI ADMIN (React Native)

## ğŸ¯ CONTEXTO DEL PROYECTO

Estoy desarrollando una aplicaciÃ³n mÃ³vil React Native para **ADMINISTRADORES DE TIENDA** del sistema SAAI (Smart Assistant for Inventory). Esta es la app mÃ¡s completa de las 3 del ecosistema.

**Rol del usuario:** ADMINISTRADOR/ADMIN
- Permisos COMPLETOS: Productos, ventas, usuarios, gastos, analÃ­tica, reportes, predicciones ML, notificaciones
- Es el dueÃ±o de la tienda, tiene acceso total excepto gestiÃ³n de otras tiendas

**Backend:** AWS Serverless (API Gateway + Lambda + DynamoDB)
- AutenticaciÃ³n: JWT (Bearer token)
- Multi-tenant: Cada admin pertenece a UNA tienda (tenant_id en JWT)
- WebSockets: Notificaciones y actualizaciones en tiempo real
- S3: Descarga de reportes Excel
- ML: PredicciÃ³n de demanda con Holt-Winters

---

## ğŸ“š ARCHIVOS DE REFERENCIA OBLIGATORIOS

**IMPORTANTE:** Antes de escribir cualquier cÃ³digo, debes leer y entender completamente estos documentos:

### 1. SAAI_oficial.txt
- **SecciÃ³n crÃ­tica:** "3. Arquitectura ADMINISTRADOR"
  - 3.1 Endpoints (Request/Response) - LÃ­neas 712-1310
  - 3.2 Lambdas (quÃ© hace cada una) - LÃ­neas 1312-1750
- **Convenciones del backend:** LÃ­neas 1-80
- **IMPORTANTE:** Leer secciÃ³n de AnalÃ­tica (ActualizarAnalitica es SOLO EventBridge, frontend usa VerAnalitica)

### 2. SAAI_resumen_tecnico.txt
- Arquitectura de AnalÃ­tica y SNS
- Predicciones ML (Holt-Winters, Docker Lambda)
- Reportes en S3 con presigned URLs
- WebSockets para eventos en tiempo real

### 3. SAAI_Backend_Complete.postman_collection.json
- **MÃ³dulos relevantes para ADMIN:**
  - 1. AUTH â†’ Login Admin
  - 2. USUARIOS â†’ CRUD completo
  - 3. PRODUCTOS â†’ CRUD completo
  - 4. VENTAS â†’ Registrar, listar, buscar
  - 5. GASTOS â†’ CRUD completo
  - 6. ANALYTICS â†’ Ver AnalÃ­tica (NO actualizar manualmente)
  - 7. REPORTES â†’ Generar 4 tipos, listar historial
  - 8. PREDICCIONES ML â†’ Predecir demanda
  - 9. NOTIFICACIONES â†’ Listar

---

## ğŸ—ï¸ ESTRUCTURA DE LA APP

```
saai-admin/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ screens/
â”‚   â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”‚   â””â”€â”€ LoginScreen.js
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ DashboardScreen.js          # Vista general con KPIs
â”‚   â”‚   â”œâ”€â”€ productos/
â”‚   â”‚   â”‚   â”œâ”€â”€ ListaProductosScreen.js
â”‚   â”‚   â”‚   â”œâ”€â”€ CrearProductoScreen.js
â”‚   â”‚   â”‚   â”œâ”€â”€ EditarProductoScreen.js
â”‚   â”‚   â”‚   â””â”€â”€ BuscarProductosScreen.js
â”‚   â”‚   â”œâ”€â”€ ventas/
â”‚   â”‚   â”‚   â”œâ”€â”€ RegistrarVentaScreen.js
â”‚   â”‚   â”‚   â”œâ”€â”€ ListaVentasScreen.js
â”‚   â”‚   â”‚   â””â”€â”€ BuscarVentasScreen.js
â”‚   â”‚   â”œâ”€â”€ usuarios/
â”‚   â”‚   â”‚   â”œâ”€â”€ ListaUsuariosScreen.js
â”‚   â”‚   â”‚   â”œâ”€â”€ CrearUsuarioScreen.js
â”‚   â”‚   â”‚   â”œâ”€â”€ EditarUsuarioScreen.js
â”‚   â”‚   â”‚   â””â”€â”€ BuscarUsuariosScreen.js
â”‚   â”‚   â”œâ”€â”€ gastos/
â”‚   â”‚   â”‚   â”œâ”€â”€ ListaGastosScreen.js
â”‚   â”‚   â”‚   â”œâ”€â”€ CrearGastoScreen.js
â”‚   â”‚   â”‚   â”œâ”€â”€ EditarGastoScreen.js
â”‚   â”‚   â”‚   â””â”€â”€ BuscarGastosScreen.js
â”‚   â”‚   â”œâ”€â”€ analitica/
â”‚   â”‚   â”‚   â””â”€â”€ AnaliticaScreen.js          # Dashboard analÃ­tico
â”‚   â”‚   â”œâ”€â”€ reportes/
â”‚   â”‚   â”‚   â”œâ”€â”€ GenerarReportesScreen.js
â”‚   â”‚   â”‚   â””â”€â”€ HistorialReportesScreen.js
â”‚   â”‚   â”œâ”€â”€ predicciones/
â”‚   â”‚   â”‚   â””â”€â”€ PrediccionDemandaScreen.js
â”‚   â”‚   â””â”€â”€ notificaciones/
â”‚   â”‚       â””â”€â”€ NotificacionesScreen.js
â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”œâ”€â”€ charts/                         # GrÃ¡ficos para analÃ­tica
â”‚   â”‚   â”‚   â”œâ”€â”€ LineChart.js
â”‚   â”‚   â”‚   â”œâ”€â”€ BarChart.js
â”‚   â”‚   â”‚   â””â”€â”€ PieChart.js
â”‚   â”‚   â”œâ”€â”€ cards/
â”‚   â”‚   â”‚   â”œâ”€â”€ KPICard.js                  # Tarjetas de mÃ©tricas
â”‚   â”‚   â”‚   â”œâ”€â”€ ProductCard.js
â”‚   â”‚   â”‚   â”œâ”€â”€ VentaCard.js
â”‚   â”‚   â”‚   â”œâ”€â”€ GastoCard.js
â”‚   â”‚   â”‚   â””â”€â”€ UsuarioCard.js
â”‚   â”‚   â”œâ”€â”€ AlertaBadge.js
â”‚   â”‚   â””â”€â”€ SearchBar.js
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ api.js
â”‚   â”‚   â”œâ”€â”€ auth.js
â”‚   â”‚   â”œâ”€â”€ productos.js
â”‚   â”‚   â”œâ”€â”€ ventas.js
â”‚   â”‚   â”œâ”€â”€ usuarios.js
â”‚   â”‚   â”œâ”€â”€ gastos.js
â”‚   â”‚   â”œâ”€â”€ analitica.js
â”‚   â”‚   â”œâ”€â”€ reportes.js
â”‚   â”‚   â”œâ”€â”€ predicciones.js
â”‚   â”‚   â””â”€â”€ websocket.js
â”‚   â”œâ”€â”€ context/
â”‚   â”‚   â”œâ”€â”€ AuthContext.js
â”‚   â”‚   â”œâ”€â”€ AnaliticaContext.js            # Estado de analÃ­tica + WebSocket updates
â”‚   â”‚   â””â”€â”€ NotificationContext.js
â”‚   â”œâ”€â”€ navigation/
â”‚   â”‚   â”œâ”€â”€ AppNavigator.js
â”‚   â”‚   â””â”€â”€ DrawerNavigator.js             # Drawer para mÃ³dulos principales
â”‚   â””â”€â”€ utils/
â”‚       â”œâ”€â”€ constants.js
â”‚       â”œâ”€â”€ helpers.js
â”‚       â””â”€â”€ chartHelpers.js                # Helpers para formatear datos de grÃ¡ficos
â””â”€â”€ App.js
```

---

## ğŸš€ ORDEN DE IMPLEMENTACIÃ“N SUGERIDO

### FASE 1: AutenticaciÃ³n y NavegaciÃ³n Base (COMENZAR AQUÃ)
1. **LoginScreen + AuthContext**
   - POST /login (admin)
   - Guardar token + user info en AsyncStorage
   - NavegaciÃ³n a DashboardScreen

2. **API Service + Interceptors**
   - Axios con Authorization header
   - Error handling 401 â†’ logout
   - Error handling genÃ©rico

3. **DrawerNavigator**
   - MenÃº lateral con mÃ³dulos: Dashboard, Productos, Ventas, Usuarios, Gastos, AnalÃ­tica, Reportes, Predicciones, Notificaciones
   - Header con nombre de tienda y logout

### FASE 2: Productos + Ventas (Herencia de TRABAJADOR)
4. **MÃ³dulo Productos** (igual que TRABAJADOR)
   - ListaProductosScreen
   - CrearProductoScreen
   - EditarProductoScreen
   - BuscarProductosScreen

5. **MÃ³dulo Ventas** (igual que TRABAJADOR)
   - RegistrarVentaScreen
   - ListaVentasScreen
   - BuscarVentasScreen

### FASE 3: Usuarios (Exclusivo ADMIN)
6. **ListaUsuariosScreen**
   - GET /usuarios con paginaciÃ³n
   - Mostrar: cÃ³digo, nombre, email, rol (admin/worker), estado

7. **CrearUsuarioScreen**
   - POST /usuarios
   - Formulario: nombre, email, password, rol
   - ValidaciÃ³n de email Ãºnico

8. **EditarUsuarioScreen**
   - PUT /usuarios/{codigo_usuario}
   - Cambiar nombre, email, rol, estado
   - NO cambiar password (feature separada)

9. **BuscarUsuariosScreen**
   - POST /usuarios/buscar
   - BÃºsqueda por: nombre, email, cÃ³digo

### FASE 4: Gastos (Exclusivo ADMIN)
10. **ListaGastosScreen**
    - GET /gastos con paginaciÃ³n
    - Mostrar: cÃ³digo, descripciÃ³n, monto, categorÃ­a, fecha
    - Filtros por categorÃ­a y rango de fechas

11. **CrearGastoScreen**
    - POST /gastos
    - Formulario: descripciÃ³n, monto, categorÃ­a, fecha
    - CategorÃ­as: FIJOS, VARIABLES, COMPRAS

12. **EditarGastoScreen**
    - PUT /gastos/{codigo_gasto}
    - Editar monto, descripciÃ³n, categorÃ­a

13. **BuscarGastosScreen**
    - POST /gastos/buscar
    - BÃºsqueda por: descripciÃ³n, categorÃ­a, fecha, monto

### FASE 5: Dashboard y AnalÃ­tica (CRÃTICO)
14. **DashboardScreen**
    - Tarjetas KPI: Total ventas hoy, ingresos del mes, productos sin stock, gastos del mes
    - GrÃ¡fico de ventas (Ãºltimos 7 dÃ­as)
    - Alertas recientes (top 3)
    - Botones rÃ¡pidos: Registrar venta, Ver analÃ­tica, Generar reporte

15. **AnaliticaScreen**
    - GET /analitica?periodo=semana
    - Tabs: DÃ­a, Semana (default), Mes
    - **IMPORTANTE:** NO llamar ActualizarAnalitica (es automÃ¡tico cada 4h)
    - WebSocket: Escuchar 'analitica_actualizada' â†’ refetch datos
    - MÃ©tricas:
      - Ventas totales
      - Ganancias brutas/netas
      - Promedio de venta
      - Productos mÃ¡s vendidos (top 5)
      - Ventas diarias (grÃ¡fico de lÃ­nea)
      - Alertas:
        - Ventas cero en periodo
        - Ganancia baja (< 10% de ingresos)
        - Productos sin stock
        - Stock bajo (â‰¤ 5 unidades)

16. **GrÃ¡ficos (react-native-chart-kit o Victory Native)**
    - LineChart para ventas diarias
    - BarChart para productos top
    - PieChart para distribuciÃ³n de ventas por categorÃ­a

### FASE 6: Reportes (Exclusivo ADMIN)
17. **GenerarReportesScreen**
    - 4 botones: Inventario, Ventas, Gastos, General
    - Formulario para reportes de periodo (fecha_inicio, fecha_fin)
    - POST /reportes/{tipo}
    - Mostrar download_url generado
    - BotÃ³n para abrir URL (Linking.openURL)

18. **HistorialReportesScreen**
    - GET /reportes/historial
    - Lista de reportes generados
    - Mostrar: cÃ³digo, tipo, fecha, tamaÃ±o
    - BotÃ³n descargar en cada item
    - **IMPORTANTE:** Los URLs son presigned (expiran en 1h), se regeneran en cada consulta

### FASE 7: Predicciones ML (Exclusivo ADMIN)
19. **PrediccionDemandaScreen**
    - Selector de producto (dropdown o autocomplete)
    - POST /predicciones con codigo_producto
    - Mostrar:
      - Demanda maÃ±ana (unidades)
      - Demanda prÃ³xima semana (7 dÃ­as)
      - Stock actual vs demanda â†’ alerta si stock < demanda
    - GrÃ¡fico de predicciÃ³n (7 dÃ­as)
    - BotÃ³n "Reabastecer" que navega a EditarProductoScreen con stock sugerido

### FASE 8: Notificaciones y WebSocket (CRÃTICO)
20. **NotificacionesScreen** (similar a TRABAJADOR pero con mÃ¡s tipos)
    - GET /notificacion
    - Tipos de alertas:
      - stock_bajo, sin_stock
      - venta_registrada
      - ganancia_baja
      - ventas_cero
      - stockBajoManana, stockBajoProximaSemana (predicciones)
    - Badge con contador de no leÃ­das
    - Severidad: INFO, WARNING, CRITICAL

21. **WebSocket Service Completo**
    - Conectar al login
    - Eventos a escuchar:
      - venta_registrada â†’ refetch ventas + analÃ­tica
      - analitica_actualizada â†’ refetch analÃ­tica
      - prediccion_generada â†’ refetch predicciÃ³n
      - producto_actualizado â†’ refetch productos
    - Mostrar notificaciones push nativas
    - Actualizar badge

---

## ğŸ’¡ TIPS ESPECÃFICOS ADMIN

### 1. AnalÃ­tica - NO Actualizar Manualmente
```javascript
// âŒ INCORRECTO: Nunca llames a ActualizarAnalitica
const actualizarAnalitica = () => api.post('/analitica'); // âŒ NO EXISTE ENDPOINT PÃšBLICO

// âœ… CORRECTO: Solo consulta analÃ­tica pre-calculada
const fetchAnalitica = (periodo = 'semana') => {
  return api.get('/analitica', { params: { periodo } });
};

// âœ… CORRECTO: Refetch cuando llega evento WebSocket
ws.onmessage = (event) => {
  const { event_type } = JSON.parse(event.data);
  if (event_type === 'analitica_actualizada') {
    fetchAnalitica(); // Re-consultar datos actualizados
  }
};
```

### 2. Reportes - Presigned URLs
```javascript
// âœ… CORRECTO: Generar reporte y abrir URL directamente
const generarReporte = async (tipo, fechas) => {
  const response = await api.post(`/reportes/${tipo}`, fechas);
  const { download_url } = response.data.data;
  
  // Abrir el archivo Excel en navegador o descargar
  Linking.openURL(download_url);
};

// âš ï¸ IMPORTANTE: Los URLs expiran en 1 hora
// En HistorialReportesScreen, el backend genera URLs frescos en cada GET /reportes/historial
```

### 3. Predicciones ML - Cache y TTL
```javascript
// âœ… Las predicciones tienen cache de 24h en backend
// No es necesario guardarlas en frontend, siempre hacer POST /predicciones

const predecirDemanda = async (codigo_producto) => {
  const response = await api.post('/predicciones', { codigo_producto });
  const { demanda_manana, demanda_proxima_semana } = response.data.data;
  
  // Comparar con stock actual
  const producto = await api.get(`/productos/${codigo_producto}`);
  const stockActual = producto.data.data.stock;
  
  if (stockActual < demanda_manana) {
    Alert.alert('âš ï¸ Stock Bajo', 'El stock no es suficiente para maÃ±ana');
  }
};
```

### 4. Usuarios - Roles
```javascript
// Roles permitidos: 'admin' y 'worker'
const crearUsuario = async (data) => {
  const usuario = {
    nombre: data.nombre,
    email: data.email,
    password: data.password,
    rol: data.rol // 'admin' o 'worker'
  };
  
  await api.post('/usuarios', usuario);
};
```

### 5. Gastos - CategorÃ­as
```javascript
// CategorÃ­as fijas en backend
const CATEGORIAS_GASTOS = [
  'FIJOS',      // Alquiler, servicios, etc.
  'VARIABLES',  // Mantenimiento, publicidad, etc.
  'COMPRAS'     // MercaderÃ­a, insumos, etc.
];

// Usar en formulario CrearGastoScreen
<Picker selectedValue={categoria} onValueChange={setCategoria}>
  {CATEGORIAS_GASTOS.map(cat => (
    <Picker.Item key={cat} label={cat} value={cat} />
  ))}
</Picker>
```

### 6. Dashboard - KPIs en Tiempo Real
```javascript
// Calcular KPIs localmente desde analÃ­tica
const calcularKPIs = (analitica) => {
  return {
    ventasHoy: analitica.periodo.dia.ventas_totales,
    ingresosHoy: analitica.periodo.dia.ingresos,
    gananciaMes: analitica.periodo.mes.ganancia_neta,
    productosSinStock: analitica.alertas.filter(a => a.tipo === 'sin_stock').length
  };
};

// Actualizar dashboard cuando llega evento WebSocket
useEffect(() => {
  if (eventType === 'analitica_actualizada') {
    fetchAnalitica().then(data => {
      setKPIs(calcularKPIs(data));
    });
  }
}, [eventType]);
```

### 7. GrÃ¡ficos - Formatear Datos
```javascript
// Formatear ventas diarias para LineChart
const formatearVentasDiarias = (ventasDiarias) => {
  return {
    labels: ventasDiarias.map(v => v.fecha.slice(5, 10)), // MM-DD
    datasets: [{
      data: ventasDiarias.map(v => v.total)
    }]
  };
};

// Usar en react-native-chart-kit
<LineChart
  data={formatearVentasDiarias(analitica.ventas_diarias)}
  width={Dimensions.get('window').width - 40}
  height={220}
  chartConfig={{...}}
/>
```

---

## ğŸ“Š FEATURES EXCLUSIVAS ADMIN

### Dashboard Ejecutivo
- KPIs en tarjetas: ventas hoy, ingresos mes, productos sin stock, gastos mes
- GrÃ¡fico de ventas (Ãºltimos 7 dÃ­as)
- Alertas recientes (top 3)
- Accesos rÃ¡pidos

### AnalÃ­tica Completa
- 3 periodos: dÃ­a, semana, mes
- MÃ©tricas: ventas, ingresos, gastos, ganancias, promedio venta
- Productos top vendidos
- GrÃ¡fico de ventas diarias
- Alertas automÃ¡ticas (generadas cada 4h por EventBridge)

### Reportes Excel
- 4 tipos: Inventario, Ventas, Gastos, General
- Descarga directa desde S3
- Historial de reportes generados

### Predicciones ML
- Demanda predicha (maÃ±ana + 7 dÃ­as)
- Alertas de stock bajo segÃºn predicciÃ³n
- Sugerencias de reabastecimiento

### GestiÃ³n de Usuarios
- CRUD completo
- Roles: admin y worker
- Soft delete (estado INACTIVO)

### GestiÃ³n de Gastos
- CRUD completo
- CategorÃ­as: FIJOS, VARIABLES, COMPRAS
- BÃºsqueda y filtros avanzados

---

## âš ï¸ ERRORES COMUNES A EVITAR

1. **NO llames a ActualizarAnalitica** (endpoint no existe pÃºblicamente, solo EventBridge)
2. **NO guardes reportes en local** (los URLs expiran, siempre refetch historial)
3. **NO caches predicciones en frontend** (backend tiene cache de 24h, siempre POST)
4. **NO permitas crear usuarios con rol 'saai'** (solo admin y worker)
5. **NO permitas gastos con monto negativo**
6. **NO muestres UUIDs** al usuario (solo cÃ³digos)
7. **NO ignores eventos WebSocket** (actualiza UI en tiempo real)
8. **NO uses categorÃ­as hardcodeadas** diferentes a las del backend

---

## ğŸ¨ UI/UX RECOMENDACIONES

1. **NavegaciÃ³n:** DrawerNavigator con 9 secciones principales
2. **Dashboard:** Pantalla inicial con overview completo
3. **GrÃ¡ficos:** react-native-chart-kit o Victory Native
4. **Colores:**
   - Primary: #1E88E5 (azul)
   - Success: #43A047 (verde)
   - Warning: #FB8C00 (naranja)
   - Danger: #E53935 (rojo)
   - Info: #00ACC1 (cyan)
5. **Icons:** MaterialCommunityIcons
6. **Forms:** React Hook Form
7. **Charts:** Victory Native o react-native-chart-kit
8. **Notifications:** react-native-push-notification
9. **File Download:** react-native-fs o Linking.openURL

---

## âœ… CHECKLIST DE IMPLEMENTACIÃ“N

- [ ] LoginScreen + AuthContext
- [ ] DrawerNavigator
- [ ] DashboardScreen con KPIs
- [ ] MÃ³dulo Productos completo
- [ ] MÃ³dulo Ventas completo
- [ ] MÃ³dulo Usuarios completo
- [ ] MÃ³dulo Gastos completo
- [ ] AnaliticaScreen con grÃ¡ficos
- [ ] WebSocket listener para 'analitica_actualizada'
- [ ] GenerarReportesScreen (4 tipos)
- [ ] HistorialReportesScreen
- [ ] PrediccionDemandaScreen
- [ ] NotificacionesScreen
- [ ] WebSocket service completo
- [ ] Error handling global
- [ ] Loading states
- [ ] Pull-to-refresh en listas
- [ ] Testing en dispositivo real

---

## ğŸš¦ COMENZAR AHORA

**Primer paso:** Lee SAAI_oficial.txt secciÃ³n "3. Arquitectura ADMINISTRADOR" completa (especialmente AnalÃ­tica).

**Segundo paso:** Revisa Postman collection mÃ³dulos: AUTH, USUARIOS, GASTOS, ANALYTICS, REPORTES, PREDICCIONES.

**Tercer paso:** Implementa LoginScreen + AuthContext + DrawerNavigator (FASE 1).

**Cuarto paso:** Implementa DashboardScreen con KPIs bÃ¡sicos (FASE 5.14).

**Pregunta clave:** Â¿Entendiste que ActualizarAnalitica NO se llama desde frontend y que WebSocket notifica cuando hay datos nuevos?

---

Â¡Empecemos con el mÃ³dulo mÃ¡s complejo! Dime cuando hayas leÃ­do los archivos de referencia y estÃ©s listo para implementar el DashboardScreen con analÃ­tica.
